#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ Barkery Bot

echo "üêï Barkery Shop - Telegram Bot"
echo "======================================"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Python
if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python3 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
if ! python3 -c "import aiogram" &> /dev/null; then
    echo "‚ö†Ô∏è  aiogram –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
    pip install -r requirements.txt > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
    else
        echo "‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
        exit 1
    fi
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ .env
echo "üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
if [ ! -f ".env" ]; then
    echo "‚ùå –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω"
    if [ -f ".env.example" ]; then
        echo "üìã –°–æ–∑–¥–∞—é .env –∏–∑ –ø—Ä–∏–º–µ—Ä–∞..."
        cp .env.example .env
        echo "‚úÖ –§–∞–π–ª .env —Å–æ–∑–¥–∞–Ω"
        echo ""
        echo "‚ö†Ô∏è  –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª:"
        echo "   1. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —É @BotFather"
        echo "   2. –£–∑–Ω–∞–π—Ç–µ —Å–≤–æ–π ID —É @userinfobot"
        echo "   3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env:"
        echo "      BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω"
        echo "      ADMIN_ID=–≤–∞—à_id"
        echo ""
        exit 1
    else
        echo "‚ùå –§–∞–π–ª .env.example –Ω–µ –Ω–∞–π–¥–µ–Ω"
        exit 1
    fi
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
if grep -q "–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞_–æ—Ç_BotFather" .env || grep -q "–≤–∞—à_telegram_id_–±–µ–∑_–∫–∞–≤—ã—á–µ–∫" .env; then
    echo "‚ùå .env –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
    echo "üìù –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª .env –∏ —É–∫–∞–∂–∏—Ç–µ:"
    echo "   BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_BotFather"
    echo "   ADMIN_ID=–≤–∞—à_id_–≤_telegram"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
echo "üóÑÔ∏è  –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."
if python3 check_db.py > /dev/null 2>&1; then
    echo "‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç"
else
    echo "‚ö†Ô∏è  –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö"
fi

echo ""
echo "‚úÖ –í–°–ï –ü–†–û–í–ï–†–ö–ò –ü–†–û–ô–î–ï–ù–´"
echo ""
echo "üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
echo ""
echo "üì± –û–¢–ö–†–û–ô–¢–ï TELEGRAM –ò –ù–ê–ô–î–ò–¢–ï –í–ê–®–ï–ì–û –ë–û–¢–ê"
echo "üëë –î–õ–Ø –ê–î–ú–ò–ù–ö–ò –í–í–ï–î–ò–¢–ï: /admin"
echo ""
echo "‚ÑπÔ∏è  –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"
echo "======================================"
echo ""

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
python3 barkery_bot.py
