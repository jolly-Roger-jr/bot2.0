"""
–í—Å–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è Barkery Shop (—Ç–æ–ª—å–∫–æ Inline)
"""
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.utils.keyboard import InlineKeyboardBuilder

# ========== –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ï –ö–õ–ê–í–ò–ê–¢–£–†–´ ==========

def main_menu_keyboard() -> InlineKeyboardMarkup:
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    builder = InlineKeyboardBuilder()

    builder.row(
        InlineKeyboardButton(text="üì¶ –ö–∞—Ç–∞–ª–æ–≥", callback_data="catalog")
    )

    builder.row(
        InlineKeyboardButton(text="üõí –ö–æ—Ä–∑–∏–Ω–∞", callback_data="cart_check"),
        InlineKeyboardButton(text="üë§ –ü—Ä–æ—Ñ–∏–ª—å", callback_data="profile")
    )

    builder.row(
        InlineKeyboardButton(text="‚ùì –ü–æ–º–æ—â—å", callback_data="help")
    )

    return builder.as_markup()

def categories_keyboard(categories: list) -> InlineKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏"""
    builder = InlineKeyboardBuilder()

    for category in categories:
        builder.row(
            InlineKeyboardButton(
                text=f"üì¶ {category['name']}",
                callback_data=f"category:{category['id']}"
            )
        )

    builder.row(
        InlineKeyboardButton(text="‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–∞—è", callback_data="main_menu"),
        InlineKeyboardButton(text="üõí –ö–æ—Ä–∑–∏–Ω–∞", callback_data="cart_check")  # –ë—ã–ª–æ cart
    )

    return builder.as_markup()


def products_keyboard(products: list, category_id: int) -> InlineKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø"""
    builder = InlineKeyboardBuilder()

    for product in products:
        # –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ç–æ–≤–∞—Ä–∞
        unit_type = product.get('unit_type', 'grams')
        if unit_type == 'grams':
            price_text = f"{product['price']} RSD/100–≥"
        else:  # pieces
            price_text = f"{product['price']} RSD/—à—Ç"

        stock_status = "‚úÖ" if product['available'] and product['stock_grams'] > 0 else "‚è≥"

        builder.row(
            InlineKeyboardButton(
                text=f"{stock_status} {product['name']} - {price_text}",
                callback_data=f"product:{product['id']}:{category_id}"
            )
        )

    builder.row(
        InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="catalog"),
        InlineKeyboardButton(text="üõí –ö–æ—Ä–∑–∏–Ω–∞", callback_data="cart_check")
    )

    return builder.as_markup()

def product_card_keyboard(product_id: int, category_id: int, current_qty: int = 0, unit_type: str = 'grams', measurement_step: int = 100) -> InlineKeyboardMarkup:
    """–ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ +/-"""
    builder = InlineKeyboardBuilder()

    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö –∏–∑–º–µ—Ä–µ–Ω–∏—è
    if unit_type == 'grams':
        # –î–ª—è –≥—Ä–∞–º–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –∞ –Ω–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤
        qty_units = current_qty
        unit_text = f'{measurement_step}–≥'
        unit_symbol = '–≥'
    else:  # pieces
        qty_units = current_qty
        unit_text = '—à—Ç'
        unit_symbol = '—à—Ç'


    # –†—è–¥ 1: –∫–Ω–æ–ø–∫–∏ +/-
    builder.row(
        InlineKeyboardButton(
            text="‚ûñ",
            callback_data=f"qty_dec:{product_id}:{category_id}"
        ),
        InlineKeyboardButton(
            text=f"{qty_units} {unit_symbol}",
            callback_data=f"qty_info:{product_id}"
        ),
        InlineKeyboardButton(
            text="‚ûï",
            callback_data=f"qty_inc:{product_id}:{category_id}"
        )
    )

    # –†—è–¥ 2: –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
    add_qty = qty_units
    if add_qty > 0:
        builder.row(
            InlineKeyboardButton(
                text=f'üõí –î–æ–±–∞–≤–∏—Ç—å ({add_qty}{unit_symbol})',
                callback_data=f"cart_add:{product_id}:{add_qty}:{category_id}"
            )
        )

    # –†—è–¥ 3: –ù–∞–≤–∏–≥–∞—Ü–∏—è
    builder.row(
        InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data=f"category:{category_id}"),
        InlineKeyboardButton(text="üõí –ö–æ—Ä–∑–∏–Ω–∞", callback_data="cart_check")  # –î–æ–±–∞–≤–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ—Ç
    )

    return builder.as_markup()

def cart_keyboard(cart_items: list, total_price: float) -> InlineKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∫–æ—Ä–∑–∏–Ω—ã"""
    builder = InlineKeyboardBuilder()

    # –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω–æ–π
    builder.row(
        InlineKeyboardButton(text="‚ùå –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ", callback_data="cart_clear"),
        InlineKeyboardButton(text="üõéÔ∏è –û—Ñ–æ—Ä–º–∏—Ç—å", callback_data="order_create")
    )

    # –ù–∞–≤–∏–≥–∞—Ü–∏—è
    builder.row(
        InlineKeyboardButton(text="‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–∞—è", callback_data="main_menu"),
        InlineKeyboardButton(text="üì¶ –ö–∞—Ç–∞–ª–æ–≥", callback_data="catalog")
    )

    return builder.as_markup()

def order_confirmation_keyboard() -> InlineKeyboardMarkup:
    """–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞"""
    builder = InlineKeyboardBuilder()

    builder.row(
        InlineKeyboardButton(text="‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å", callback_data="order_confirm"),
        InlineKeyboardButton(text="‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å", callback_data="cart_check")
    )

    builder.row(
        InlineKeyboardButton(text="‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–∞—è", callback_data="main_menu")
    )

    return builder.as_markup()

def help_keyboard() -> InlineKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø–æ–º–æ—â–∏"""
    builder = InlineKeyboardBuilder()

    builder.row(
        InlineKeyboardButton(text="‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–∞—è", callback_data="main_menu")
    )

    return builder.as_markup()

# ========== –ê–î–ú–ò–ù–°–ö–ò–ï –ö–õ–ê–í–ò–ê–¢–£–†–´ ==========

def admin_main_keyboard() -> InlineKeyboardMarkup:
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω–∫–∏"""
    builder = InlineKeyboardBuilder()

    builder.row(
        InlineKeyboardButton(text="üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏", callback_data="admin_categories"),
        InlineKeyboardButton(text="üõí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏", callback_data="admin_products")
    )

    builder.row(
        InlineKeyboardButton(text="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="admin_statistics")
    )

    builder.row(
        InlineKeyboardButton(text="‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä", callback_data="admin_add_product")
    )

    return builder.as_markup()

def admin_categories_keyboard(categories: list) -> InlineKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏"""
    builder = InlineKeyboardBuilder()

    for category in categories:
        builder.row(
            InlineKeyboardButton(
                text=f"üì¶ {category['name']}",
                callback_data=f"admin_category_products:{category['id']}"
            ),
            InlineKeyboardButton(
                text="‚úèÔ∏è",
                callback_data=f"admin_edit_category:{category['id']}"
            ),
            InlineKeyboardButton(
                text="‚ùå",
                callback_data=f"admin_delete_category:{category['id']}"
            )
        )

    builder.row(
        InlineKeyboardButton(text="‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é", callback_data="admin_add_category"),
        InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="admin_back")
    )

    return builder.as_markup()

def admin_products_keyboard(categories: list) -> InlineKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
    builder = InlineKeyboardBuilder()

    for category in categories:
        builder.row(
            InlineKeyboardButton(
                text=f"üì¶ {category.name}",
                callback_data=f"admin_category_products:{category.id}"
            )
        )

    builder.row(
        InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –∞–¥–º–∏–Ω–∫—É", callback_data="admin_back"),
        InlineKeyboardButton(text="‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä", callback_data="admin_add_product")
    )

    return builder.as_markup()


def admin_product_management_keyboard(products: list, category_id: int) -> InlineKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏ —Å –≥–∏–ø–æ–∞–ª–ª–µ—Ä–≥–µ–Ω–Ω–æ—Å—Ç—å—é"""
    builder = InlineKeyboardBuilder()

    for product in products:
        status = "‚úÖ" if product["available"] else "‚õî"

        # –ò–∫–æ–Ω–∫–∞ –≥–∏–ø–æ–∞–ª–ª–µ—Ä–≥–µ–Ω–Ω–æ—Å—Ç–∏
        hypo_icon = "üéÉüêü" if product.get('is_hypoallergenic', False) else "‚ö™"

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤
        unit_type = product.get('unit_type', 'grams')
        if unit_type == 'grams':
            stock_status = f"{product['stock_grams']}–≥"
        else:  # pieces
            stock_status = f"{product['stock_grams']}—à—Ç"

        # –†–Ø–î 1: –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ —Å –∏–∫–æ–Ω–∫–∞–º–∏
        builder.row(
            InlineKeyboardButton(
                text=f"{status}{hypo_icon} {product['name']} - {product['price']}RSD ({stock_status})",
                callback_data=f"admin_edit_product_full:{product['id']}:{category_id}"
            )
        )

        # –†–Ø–î 2: –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
        builder.row(
            InlineKeyboardButton(
                text="üîÑ –í–∫–ª/–í—ã–∫–ª",
                callback_data=f"admin_toggle_product:{product['id']}:{category_id}"
            ),
            InlineKeyboardButton(
                text="üí∞ –¶–µ–Ω–∞",
                callback_data=f"admin_edit_product_price:{product['id']}:{category_id}"
            ),
            InlineKeyboardButton(
                text="üì¶ –û—Å—Ç–∞—Ç–∫–∏",
                callback_data=f"admin_update_stock:{product['id']}:{category_id}"
            )
        )

        # –†–Ø–î 3: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
        builder.row(
            InlineKeyboardButton(
                text="üî¨ –ì–∏–ø–æ",
                callback_data=f"admin_toggle_hypoallergenic:{product['id']}:{category_id}"
            ),
            InlineKeyboardButton(
                text="‚úèÔ∏è –ù–∞–∑–≤–∞–Ω–∏–µ",
                callback_data=f"admin_edit_product_name:{product['id']}:{category_id}"
            ),
            InlineKeyboardButton(
                text="‚ùå –£–¥–∞–ª–∏—Ç—å",
                callback_data=f"admin_delete_product:{product['id']}:{category_id}"
            )
        )

    # –†–Ø–î 4: –ù–∞–≤–∏–≥–∞—Ü–∏—è
    builder.row(
        InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º", callback_data="admin_products"),
        InlineKeyboardButton(text="üè† –í –≥–ª–∞–≤–Ω–æ–µ", callback_data="admin_back")
    )

    return builder.as_markup()


def admin_product_edit_keyboard(product_id: int, category_id: int) -> InlineKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
    builder = InlineKeyboardBuilder()

    builder.row(
        InlineKeyboardButton(
            text="‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ",
            callback_data=f"admin_edit_product_name:{product_id}:{category_id}"
        )
    )

    builder.row(
        InlineKeyboardButton(
            text="üí∞ –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É",
            callback_data=f"admin_edit_product_price:{product_id}:{category_id}"
        )
    )

    builder.row(
        InlineKeyboardButton(
            text="üì¶ –ò–∑–º–µ–Ω–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏",
            callback_data=f"admin_edit_product_stock:{product_id}:{category_id}"
        )
    )

    builder.row(
        InlineKeyboardButton(
            text="üìù –ò–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ",
            callback_data=f"admin_edit_product_description:{product_id}:{category_id}"
        )
    )

    builder.row(
        InlineKeyboardButton(
            text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
            callback_data=f"admin_category_products:{category_id}"
        ),
        InlineKeyboardButton(
            text="üè† –í –≥–ª–∞–≤–Ω–æ–µ",
            callback_data="admin_back"
        )
    )

    return builder.as_markup()

# –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é –∞–¥–º–∏–Ω–∫–∏ (–∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é)
def admin_main_keyboard() -> InlineKeyboardMarkup:
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω–∫–∏"""
    builder = InlineKeyboardBuilder()

    builder.row(
        InlineKeyboardButton(text="üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏", callback_data="admin_categories"),
        InlineKeyboardButton(text="üõí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏", callback_data="admin_products")
    )

    builder.row(
        InlineKeyboardButton(text="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="admin_statistics")
    )

    builder.row(
        InlineKeyboardButton(text="‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä", callback_data="admin_add_product")
    )

    return builder.as_markup()

